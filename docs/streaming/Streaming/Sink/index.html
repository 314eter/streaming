<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Sink (streaming.Streaming.Sink)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> – <a href="../../index.html">streaming</a> &#x00BB; <a href="../index.html">Streaming</a> &#x00BB; Sink</nav><h1>Module <code>Streaming.Sink</code></h1><p>Operations on sinks and sink instances.</p><div class="sidebar"><nav class="toc"><ul><li><a href="#combining-sinks">Combining sinks</a></li><li><a href="#sinks">Sinks</a></li><li><a href="#finding-elements">Finding elements</a></li><li><a href="#resource-management">Resource management</a></li></ul></nav><nav class="module-index"><ul><li><a href="./Syntax/index.html">Syntax</a></li></ul></nav></div></header><aside><ul><li>The calls to `full` should be cheap as this function will be called to avoid allocation of unnecessary resources. If the computation required to decide if the reducer is full is expensive, consider caching it whenever possible.</li></ul><ul><li>If the producer's initialization is cheap, it should assume that reducer's initialization is expensive and, if possible, avoid calling init on the reducer.</li></ul><ul><li>If the producer's initialization is expensive, it should assume that reducer's initialization is cheap and, if possible, avoid it's own initialization.</li></ul><ul><li>Category</li><li>Monoid</li><li>Profunctor</li><li>Strong (first, second)</li><li>Choice (left, right)</li><li>Alternative</li><li>Bifunctor</li><li>Monad</li><li>Applicative</li><li>Comonad</li></ul><ul><li>consider adding: lift, before or after</li><li>await?</li></ul><p>let* x = Sink.await in let* y = Sink.await in Sink.return (x + y)</p><p>race</p><p>or_else, recover repeat</p></aside><dl><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type</span> <span>('a, 'b) t</span></code><code> = <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="../index.html#type-sink">sink</a></span></code></dt></dl><dl><dt class="spec value" id="val-make"><a href="#val-make" class="anchor"></a><code><span class="keyword">val</span> make : <span>init:<span>(unit <span>&#45;&gt;</span> <span class="type-var">'s</span>)</span></span> <span>&#45;&gt;</span> <span>push:<span>(<span class="type-var">'s</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'s</span>)</span></span> <span>&#45;&gt;</span> <span>?&#8288;full:<span>(<span class="type-var">'s</span> <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span>stop:<span>(<span class="type-var">'s</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>)</span></span> <span>&#45;&gt;</span> unit <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Creates a sink from a function that <code>init</code>ializes a state value, a <code>step</code>ping function to update that state and a <code>stop</code> function that produces the final result value. Optionally a <code>full</code> function can be passed to decide when the sink should terminate early.</p></dd></dl><dl><dt class="spec value" id="val-map"><a href="#val-map" class="anchor"></a><code><span class="keyword">val</span> map : <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>)</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'b</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-(&lt;@&gt;)"><a href="#val-(&lt;@&gt;)" class="anchor"></a><code><span class="keyword">val</span> (&lt;@&gt;) : <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>)</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'a</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'b</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-fill"><a href="#val-fill" class="anchor"></a><code><span class="keyword">val</span> fill : <span class="type-var">'a</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'a</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dt class="spec value" id="val-(&lt;*&gt;)"><a href="#val-(&lt;*&gt;)" class="anchor"></a><code><span class="keyword">val</span> (&lt;*&gt;) : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'c</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="index.html#type-t">t</a></span></code></dt></dl><section><header><h2 id="combining-sinks"><a href="#combining-sinks" class="anchor"></a>Combining sinks</h2></header><dl><dt class="spec value" id="val-both"><a href="#val-both" class="anchor"></a><code><span class="keyword">val</span> both : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'r1</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'r2</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'r1</span> * <span class="type-var">'r2</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>both sink1 sink2</code> computes both <code>sink1</code> and <code>sink2</code> at the same time.</p></dd></dl><dl><dt class="spec value" id="val-distribute"><a href="#val-distribute" class="anchor"></a><code><span class="keyword">val</span> distribute : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'r1</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'r2</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'r1</span> * <span class="type-var">'r2</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>distribute sink1 sink2</code> is similar to <code>both</code> but distributes the consumed elements over <code>sink1</code> and <code>sink2</code> alternating in round robin fashion.</p></dd></dl><dl><dt class="spec value" id="val-unzip"><a href="#val-unzip" class="anchor"></a><code><span class="keyword">val</span> unzip : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'r1</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'b</span>, <span class="type-var">'r2</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span> * <span class="type-var">'b</span>, <span class="type-var">'r1</span> * <span class="type-var">'r2</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>unzip sink1 sink2</code> is a sink that receives pairs, sending the first element into <code>sink1</code> and the second into <code>sink2</code>. Both sinks are computed at the same time and their results returned as an output pair.</p></dd></dl></section><section><header><h2 id="sinks"><a href="#sinks" class="anchor"></a>Sinks</h2></header><dl><dt class="spec value" id="val-full"><a href="#val-full" class="anchor"></a><code><span class="keyword">val</span> full : <span><span>(<span class="type-var">'a</span>, unit)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>A full sink that will not consume any elements and will not produce any results.</p></dd></dl><dl><dt class="spec value" id="val-drain"><a href="#val-drain" class="anchor"></a><code><span class="keyword">val</span> drain : <span><span>(<span class="type-var">'a</span>, unit)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Consumes all elements producing nothing. Useful for triggering actions in effectful streams.</p></dd></dl><dl><dt class="spec value" id="val-fold"><a href="#val-fold" class="anchor"></a><code><span class="keyword">val</span> fold : <span>(<span class="type-var">'b</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'b</span>)</span> <span>&#45;&gt;</span> <span class="type-var">'b</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>fold f init</code> is a sink that reduces all input elements with the stepping function <code>f</code> starting with the accumulator value <code>init</code>.</p></dd></dl><dl><dt class="spec value" id="val-is_empty"><a href="#val-is_empty" class="anchor"></a><code><span class="keyword">val</span> is_empty : <span><span>(<span class="type-var">'a</span>, bool)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>is_empty</code> is <code>true</code> if the sink did not consume any elements and <code>false</code> otherwise.</p></dd></dl><dl><dt class="spec value" id="val-each"><a href="#val-each" class="anchor"></a><code><span class="keyword">val</span> each : <span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> unit)</span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, unit)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Applies an effectful action to all input elements producing nothing.</p></dd></dl><dl><dt class="spec value" id="val-length"><a href="#val-length" class="anchor"></a><code><span class="keyword">val</span> length : <span><span>(<span class="type-var">'a</span>, int)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Consumes and counts all input elements.</p></dd></dl><dl><dt class="spec value" id="val-first"><a href="#val-first" class="anchor"></a><code><span class="keyword">val</span> first : <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'a</span> option</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>The first input element. Equivalent to <code>nth 0</code>.</p></dd></dl><dl><dt class="spec value" id="val-last"><a href="#val-last" class="anchor"></a><code><span class="keyword">val</span> last : <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'a</span> option</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>The last input element.</p></dd></dl><dl><dt class="spec value" id="val-nth"><a href="#val-nth" class="anchor"></a><code><span class="keyword">val</span> nth : int <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'a</span> option</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>The n-th input element.</p></dd></dl><dl><dt class="spec value" id="val-mean"><a href="#val-mean" class="anchor"></a><code><span class="keyword">val</span> mean : <span><span>(float, float)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Computes a numerically stable arithmetic mean of all input elements.</p></dd></dl></section><section><header><h2 id="finding-elements"><a href="#finding-elements" class="anchor"></a>Finding elements</h2></header><dl><dt class="spec value" id="val-contains"><a href="#val-contains" class="anchor"></a><code><span class="keyword">val</span> contains : <span>where:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, bool)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>contains ~where:pred</code> finds the first element that satisfies <code>pred</code> returning <code>None</code> if there is no such element.</p></dd></dl><dl><dt class="spec value" id="val-find"><a href="#val-find" class="anchor"></a><code><span class="keyword">val</span> find : <span>where:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'a</span> option</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>find ~where:pred</code> finds the first element that satisfies <code>pred</code> returning <code>None</code> if there is no such element.</p></dd></dl><dl><dt class="spec value" id="val-index"><a href="#val-index" class="anchor"></a><code><span class="keyword">val</span> index : <span>where:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span>int option</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Similar to <code>find</code> but returns the index of the element that satisfies the predicate.</p></dd></dl><dl><dt class="spec value" id="val-minimum"><a href="#val-minimum" class="anchor"></a><code><span class="keyword">val</span> minimum : <span>by:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'a</span> option</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Finds the minimum element in the sequence, using the given predicate as as the comparison between the input elements.</p></dd></dl><dl><dt class="spec value" id="val-maximum"><a href="#val-maximum" class="anchor"></a><code><span class="keyword">val</span> maximum : <span>by:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> <span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'a</span> option</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Finds the maximum element in the sequence, using the given predicate as as the comparison between the input elements.</p></dd></dl><dl><dt class="spec value" id="val-all"><a href="#val-all" class="anchor"></a><code><span class="keyword">val</span> all : <span>where:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, bool)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>all ~where:pred</code> is <code>true</code> if all input element satisfy <code>pred</code>. Will stop consuming elements when the first element that does not satisfy <code>pred</code> is found. Results in <code>true</code> for empty input.</p></dd></dl><dl><dt class="spec value" id="val-any"><a href="#val-any" class="anchor"></a><code><span class="keyword">val</span> any : <span>where:<span>(<span class="type-var">'a</span> <span>&#45;&gt;</span> bool)</span></span> <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, bool)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>any ~where:pred</code> is <code>true</code> if at least one input element satisfies <code>pred</code>. Will stop consuming elements when such an element is found. Results in <code>false</code> for empty input.</p></dd></dl><dl><dt class="spec value" id="val-print"><a href="#val-print" class="anchor"></a><code><span class="keyword">val</span> print : <span><span>(string, unit)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Prints all input string elements to standard output as lines.</p></dd></dl><dl><dt class="spec value" id="val-list"><a href="#val-list" class="anchor"></a><code><span class="keyword">val</span> list : <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'a</span> list</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Puts all input elements into a list.</p></dd></dl><dl><dt class="spec value" id="val-array"><a href="#val-array" class="anchor"></a><code><span class="keyword">val</span> array : <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'a</span> array</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Puts all input elements into an array.</p></dd></dl><dl><dt class="spec value" id="val-buffer"><a href="#val-buffer" class="anchor"></a><code><span class="keyword">val</span> buffer : int <span>&#45;&gt;</span> <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'a</span> array</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Similar to <a href="index.html#val-array"><code>array</code></a> buf will only consume <code>n</code> elements.</p></dd></dl><dl><dt class="spec value" id="val-queue"><a href="#val-queue" class="anchor"></a><code><span class="keyword">val</span> queue : <span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'a</span> Stdlib.Queue.t</span>)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Puts all input elements into a queue.</p></dd></dl><dl><dt class="spec value" id="val-sum"><a href="#val-sum" class="anchor"></a><code><span class="keyword">val</span> sum : <span><span>(int, int)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Adds all input integer values.</p></dd></dl><dl><dt class="spec value" id="val-product"><a href="#val-product" class="anchor"></a><code><span class="keyword">val</span> product : <span><span>(int, int)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Product of input integer values. Stops if any input element is <code>0</code>.</p></dd></dl><dl><dt class="spec value" id="val-string"><a href="#val-string" class="anchor"></a><code><span class="keyword">val</span> string : <span><span>(string, string)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Consumes and concatenates strings.</p></dd></dl><dl><dt class="spec value" id="val-bytes"><a href="#val-bytes" class="anchor"></a><code><span class="keyword">val</span> bytes : <span><span>(bytes, bytes)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>Consumes and concatenates bytes.</p></dd></dl><dl><dt class="spec value" id="val-file"><a href="#val-file" class="anchor"></a><code><span class="keyword">val</span> file : string <span>&#45;&gt;</span> <span><span>(string, unit)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p><code>file path</code> is a sink that writes input strings as lines into a file located at <code>path</code>.</p></dd></dl><dl><dt class="spec value" id="val-stdout"><a href="#val-stdout" class="anchor"></a><code><span class="keyword">val</span> stdout : <span><span>(string, unit)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>A sink that writes input strings as lines to STDOUT.</p></dd></dl><dl><dt class="spec value" id="val-stderr"><a href="#val-stderr" class="anchor"></a><code><span class="keyword">val</span> stderr : <span><span>(string, unit)</span> <a href="index.html#type-t">t</a></span></code></dt><dd><p>A sink that writes input strings as lines to STDERR.</p></dd></dl></section><section><header><h2 id="resource-management"><a href="#resource-management" class="anchor"></a>Resource management</h2></header><dl><dt class="spec value" id="val-dispose"><a href="#val-dispose" class="anchor"></a><code><span class="keyword">val</span> dispose : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'r</span>)</span> <a href="index.html#type-t">t</a></span> <span>&#45;&gt;</span> <span class="type-var">'r</span></code></dt><dd><p>Close the sink and produce the currently accumulated result.</p></dd></dl><div class="spec module" id="module-Syntax"><a href="#module-Syntax" class="anchor"></a><code><span class="keyword">module</span> <a href="Syntax/index.html">Syntax</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section></div></body></html>