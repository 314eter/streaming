<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Streaming (streaming.Streaming)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">streaming</a> &#x00BB; Streaming</nav><h1>Module <code>Streaming</code></h1><p>Pure, safe and fast streaming abstractions that compose.</p><nav class="toc"><ul><li><a href="#sources">Sources</a><ul><li><a href="#custom-sources">Custom sources</a></li></ul></li><li><a href="#sinks">Sinks</a><ul><li><a href="#combining-sinks">Combining sinks</a></li><li><a href="#custom-sinks">Custom sinks</a></li></ul></li><li><a href="#flows">Flows</a></li><li><a href="#streams">Streams</a><ul><li><a href="#examples">Examples</a></li></ul></li></ul></nav><div class="sidebar"><nav class="module-index"><ul><li><a href="./Source/index.html">Source</a></li><li><a href="./Sink/index.html">Sink</a></li><li><a href="./Flow/index.html">Flow</a></li><li><a href="./Stream/index.html">Stream</a></li></ul></nav></div></header><section><header><h2 id="sources"><a href="#sources" class="anchor"></a>Sources</h2><p>Sources are streaming producers of values.</p><p>Elements are pulled from a source on demand. A source can have an internal state that will be lazily initialized when (and if) a consumer requests elements. The internal state will be safely disposed when the source runs out of elements, when the consumer terminates, or if an exception is raised at any point in the streaming pipeline.</p></header><section><header><h3 id="custom-sources"><a href="#custom-sources" class="anchor"></a>Custom sources</h3><p>Implementing your own custom sources enables access to many useful operations without much effort. To create a source use the <a href="Source/index.html#val-make"><code>Source.make</code></a> function.</p><p>The following example creates a source that counts down to zero:</p><pre><code class="ml">let countdown n =
  let pull i =
    if i = 0 then None
    else Some (i, i - 1)) in
  Source.make ~init:n ~pull</code></pre><p>For more details on sources see the <a href="Source/index.html"><code>Source</code></a> module.</p></header><dl><dt class="spec type" id="type-source"><a href="#type-source" class="anchor"></a><code><span class="keyword">type</span> <span>'a source</span></code></dt><dd><p>A streaming producer of values of type <code>'a</code>.</p><p>The easiest way to create a source is to use the <a href="Source/index.html#val-unfold"><code>Source.unfold</code></a> function.</p></dd></dl><dl><dt class="spec module" id="module-Source"><a href="#module-Source" class="anchor"></a><code><span class="keyword">module</span> <a href="Source/index.html">Source</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Source implementations and operations on sources.</p></dd></dl></section></section><section><header><h2 id="sinks"><a href="#sinks" class="anchor"></a>Sinks</h2><p>Sinks are streaming abstractions that consume values and produce a single aggregated value as a result.</p><p>The result value is extracted from an internal state that is built incrementally.</p></header><section><header><h3 id="combining-sinks"><a href="#combining-sinks" class="anchor"></a>Combining sinks</h3><p>It is possible to <a href="./Sink/index.html#combining-sinks">combine</a> sinks and produce a result computed by multiple sinks at the same time. The most common example of this is a sink that calculates the arithmetic mean, defined as:</p><pre><code class="ml">let mean =
  let+ total = Sink.sum
  and+ count = Sink.length in
  total / count</code></pre><p><em>Note:</em> This example uses the new applicative let-syntax.</p><p>When <code>mean</code> starts processing the input elements it will compute the sum and the length at the same time, avoiding the need to process the input two times.</p><p>Sinks are independent from sources and streams. You can think of them as packed arguments for folding functions.</p><p>A convenient way to feed a sink is to use the <a href="Stream/index.html#val-into"><code>Stream.into</code></a> function.</p><pre><code class="ml">Stream.into Sink.mean (Stream.of_list [2.0; 4.0; 5.0])</code></pre></header></section><section><header><h3 id="custom-sinks"><a href="#custom-sinks" class="anchor"></a>Custom sinks</h3><p>Implementing custom sinks is useful to create a collection of reusable streaming consumers for your application.</p><p>The following example demonstrates a sink that consumes all elements into a list:</p><pre><code class="ml">let list_sink =
  let init () = [] in
  let push acc x = x :: acc in
  let stop acc = List.rev acc in
  Sink.make ~init ~push ~stop ()</code></pre></header><dl><dt class="spec type" id="type-sink"><a href="#type-sink" class="anchor"></a><code><span class="keyword">type</span> <span>('a, 'b) sink</span></code></dt><dd><p>A streaming consumer of values of type <code>'a</code> that, once done, produces a value of type <code>'b</code>.</p></dd></dl><dl><dt class="spec module" id="module-Sink"><a href="#module-Sink" class="anchor"></a><code><span class="keyword">module</span> <a href="Sink/index.html">Sink</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Operations on sinks and sink instances.</p></dd></dl></section></section><section><header><h2 id="flows"><a href="#flows" class="anchor"></a>Flows</h2><p>Flows are composable stream transformers.</p><p>A flow can be applied to a stream with <a href="Stream/index.html#val-via"><code>Stream.via</code></a>:</p><pre><code class="ml">Stream.range 10
|&gt; Stream.via (Flow.map (fun x -&gt; x + 1))
|&gt; Stream.into Sink.sum</code></pre><p>Flows can be composed to form pipelines:</p><pre><code class="ml">let flow = Flow.(map (fun x -&gt; x + 1) &gt;&gt; filter (fun x -&gt; x mod 2 = 0)) in
Stream.range 10
|&gt; Stream.via flow
|&gt; Stream.into Sink.sum</code></pre></header><dl><dt class="spec type" id="type-flow"><a href="#type-flow" class="anchor"></a><code><span class="keyword">type</span> <span>('a, 'b) flow</span></code></dt><dd><p>Stream transformers that consume values of type <code>'a</code> and produce values of type <code>'b</code>.</p></dd></dl><dl><dt class="spec module" id="module-Flow"><a href="#module-Flow" class="anchor"></a><code><span class="keyword">module</span> <a href="Flow/index.html">Flow</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></dt><dd><p>Operations on flows and common flow instances.</p></dd></dl></section><section><header><h2 id="streams"><a href="#streams" class="anchor"></a>Streams</h2><p>Stream is a functional abstraction for incremental sequential processing of elements. Streams can be easily and efficiently transformed and concatenated.</p><p>Stream operations do not leak resources. This is guaranteed in the presence of early termination (when not all stream elements are consumed) or in case of exceptions in the streaming pipeline.</p><p>Streams are built to be compatible with <a href="#sources">sources</a>, <a href="#sinks">sinks</a> and <a href="#flows">flows</a>. To create a stream that produces all elements from a source use <a href="Stream/index.html#val-from"><code>Stream.from</code></a>, to consume a stream with a sink use <a href="Stream/index.html#val-into"><code>Stream.into</code></a> and to transform stream elements with a flow use <a href="Stream/index.html#val-via"><code>Stream.via</code></a>.</p></header><section><header><h5 id="examples"><a href="#examples" class="anchor"></a>Examples</h5><p>A simple echo program that loops over standard input and prints every line to standard output until Ctrl-D is hit:</p><pre><code class="ml"># Stream.stdin |&gt; Stream.stdout;;
hello&lt;Enter&gt;
hello
world&lt;Enter&gt;
world
&lt;Ctrl+D&gt;
- : unit = ()</code></pre></header><dl><dt class="spec type" id="type-stream"><a href="#type-stream" class="anchor"></a><code><span class="keyword">type</span> <span>'a stream</span></code></dt><dd><p>A stream of elements of type <code>'a</code>.</p></dd></dl><div class="spec module" id="module-Stream"><a href="#module-Stream" class="anchor"></a><code><span class="keyword">module</span> <a href="Stream/index.html">Stream</a> : <span class="keyword">sig</span> ... <span class="keyword">end</span></code></div></section></section></div></body></html>